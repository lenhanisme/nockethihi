<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tr·∫£i Nghi·ªám Locket Gold Vƒ©nh Vi√™n Free - Kh√¥ng iPA , Shadowrocket ! | LOCKET.VN</title>
    
    <link rel="icon" href="unnamed.jpg" type="image/jpeg">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * { -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0f0f0f; min-height: 100vh; font-family: 'Inter', sans-serif; overflow-x: hidden; color: #e0e0e0; display: flex; flex-direction: column; }
        
        /* --- GOLD THEME STYLES --- */
        .gold-text { background: linear-gradient(90deg, #FFD700, #FFF3A0, #FFD700); background-size: 200% auto; -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; animation: shine 4s linear infinite; }
        @keyframes shine { to { background-position: 200% center; } }
        
        .gold-btn { background: linear-gradient(135deg, #FFD700, #F5C400, #E6B800); box-shadow: 0 10px 30px rgba(255, 200, 0, 0.4); border: none; color: #000; font-weight: 800; cursor: pointer; transition: all 0.3s; }
        .gold-btn:hover { transform: scale(1.02); box-shadow: 0 15px 40px rgba(255, 200, 0, 0.5); }
        .gold-btn:disabled { opacity: 0.7; transform: none; cursor: not-allowed; }

        .glass { backdrop-filter: blur(18px); background: rgba(20, 20, 20, 0.7); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glow { position: absolute; width: 400px; height: 400px; background: radial-gradient(circle, #FFD700, transparent 70%); filter: blur(100px); opacity: 0.1; z-index: -1; pointer-events: none; }
        
        /* --- LAYOUT --- */
        header { border-bottom: 1px solid rgba(255, 255, 255, 0.1); position: sticky; top: 0; z-index: 50; }
        header .max-w-6xl { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; }
        .nav-brand { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .nav-logo { width: 32px; height: 32px; border-radius: 8px; object-fit: cover; border: 1px solid rgba(255, 215, 0, 0.3); }

        .container { position: relative; flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        
        .card { width: 100%; max-width: 480px; padding: 32px 24px; border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); transition: transform 0.3s; }
        /* .card:hover { transform: translateY(-5px); } */
        
        .card-header { text-align: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 2px solid rgba(255, 215, 0, 0.3); }
        .card-header h2 { font-size: 28px; font-weight: 800; margin-bottom: 8px; color: #e0e0e0; }
        .card-header p { color: #b0b0b0; font-size: 15px; }

        /* --- FORM ELEMENTS --- */
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-label { display: block; font-weight: 600; color: #e0e0e0; margin-bottom: 8px; font-size: 14px; }
        .form-input { width: 100%; padding: 14px 16px; border: 2px solid #333; border-radius: 12px; font-size: 15px; background: #1a1a1a; color: #e0e0e0; transition: all 0.3s; outline: none; }
        .form-input:focus { border-color: #FFD700; box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.2); }

        .submit-btn { width: 100%; padding: 16px; border-radius: 12px; font-size: 16px; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 16px; }
        
        .config-btn { width: 100%; padding: 14px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #b0b0b0; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
        .config-btn:hover { background: rgba(255, 255, 255, 0.1); color: #fff; border-color: rgba(255, 255, 255, 0.3); }

        /* --- NEW FEATURES GRID (UPDATED) --- */
        .features { margin-top: 32px; padding-top: 24px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
        .features-title { color: #e0e0e0; font-weight: 700; font-size: 16px; margin-bottom: 20px; text-align: center; }
        .features-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .feature-item { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px 10px; background: rgba(255, 255, 255, 0.03); border-radius: 16px; border: 1px solid rgba(255, 215, 0, 0.1); font-size: 13px; color: #ccc; transition: all 0.3s ease; }
        .feature-item:hover { border-color: rgba(255, 215, 0, 0.3); background: rgba(255, 215, 0, 0.05); transform: translateY(-2px); }
        .feature-icon-lg { font-size: 28px; margin-bottom: 10px; display: block; }
        
        /* --- LOADING SCREEN --- */
        .loading-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #0f0f0f; display: flex; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.6s ease-out; }
        .loading-screen.hidden { opacity: 0; pointer-events: none; }
        .loading-container { text-align: center; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid rgba(255, 215, 0, 0.2); border-top: 4px solid #FFD700; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { color: #FFD700; font-weight: 700; letter-spacing: 2px; }

        /* --- WELCOME MODAL --- */
        .welcome-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .welcome-modal.show { display: flex; animation: fadeIn 0.3s ease; }
        .welcome-content { background: #1a1a1a; border: 2px solid #FFD700; border-radius: 24px; padding: 40px 30px; max-width: 450px; width: 100%; text-align: center; box-shadow: 0 0 50px rgba(255, 215, 0, 0.2); position: relative; }
        .welcome-btn { width: 100%; padding: 14px; margin-top: 10px; border-radius: 12px; cursor: pointer; font-weight: 700; border: none; transition: all 0.2s; }
        .btn-ok { background: linear-gradient(135deg, #FFD700, #F5C400, #E6B800); color: #000; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3); }
        .btn-ok:hover { transform: scale(1.02); }
        .btn-skip { background: transparent; color: #aaa; border: 2px solid rgba(255,255,255,0.1); }
        .btn-skip:hover { border-color: rgba(255,255,255,0.3); color: #fff; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- SWEETALERT CUSTOM UI (REDUX) --- */
        div:where(.swal2-container) div:where(.swal2-popup) { background: #1a1a1a !important; border: 1px solid rgba(255, 215, 0, 0.2); border-radius: 24px !important; padding: 30px 24px !important; }
        .swal2-title { color: #fff !important; font-size: 22px !important; font-weight: 800 !important; }
        .swal2-html-container { color: #ccc !important; margin: 20px 0 !important; }
        
        /* Actions container - Stack buttons with gap */
        div:where(.swal2-container) .swal2-actions { flex-direction: column-reverse; gap: 12px; width: 100%; margin-top: 20px !important; }

        /* Confirm Button - Gold Style */
        .swal-btn-confirm { background: linear-gradient(135deg, #FFD700, #F5C400, #E6B800) !important; color: #000 !important; font-weight: 800 !important; border-radius: 12px !important; padding: 16px 24px !important; width: 100% !important; box-shadow: 0 5px 20px rgba(255, 200, 0, 0.3); border: none !important; font-size: 16px !important; display: flex !important; align-items: center !important; justify-content: center !important; gap: 8px; }
        
        /* Cancel Button - Outline Style */
        .swal-btn-cancel { background: transparent !important; color: #b0b0b0 !important; border: 2px solid rgba(255,255,255,0.15) !important; border-radius: 12px !important; padding: 14px 24px !important; width: 100% !important; font-weight: 700 !important; font-size: 15px !important; transition: all 0.2s; }
        .swal-btn-cancel:hover { border-color: rgba(255,255,255,0.4) !important; color: #fff !important; }

        /* User info in SweetAlert */
        .user-avatar-ring { width: 100px; height: 100px; margin: 0 auto 20px; padding: 4px; border: 2px dashed #FFD700; border-radius: 50%; }
        .user-avatar-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .swal-user-name { font-size: 20px; font-weight: 700; color: white; margin-bottom: 5px; }
        .swal-user-uid { color: #FFD700; font-size: 14px; font-weight: 600; background: rgba(255, 215, 0, 0.1); padding: 4px 12px; border-radius: 20px; display: inline-block; margin-bottom: 20px; }

        /* Queue UI */
        .queue-container { text-align: left; margin-top: 15px; background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,215,0,0.1); }
        .progress-track { height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; margin: 12px 0; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #FFD700, #F5C400); width: 0%; transition: width 0.5s ease-in-out; box-shadow: 0 0 15px rgba(255, 215, 0, 0.4); }
        .queue-stats { display: flex; justify-content: space-between; color: #aaa; font-size: 13px; font-weight: 600; }
        
        /* Footer */
        footer { text-align: center; padding: 20px; font-size: 13px; color: #666; margin-top: auto; }
    </style>
</head>
<body>

    <div id="loadingScreen" class="loading-screen">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">LOCKET.VN</div>
        </div>
    </div>

    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-content">
            <div style="font-size: 50px; margin-bottom: 15px;">üëã</div>
            <h2 class="gold-text" style="font-size: 26px; margin-bottom: 10px;">Xin ch√†o!</h2>
            <p style="color: #bbb; margin-bottom: 25px; line-height: 1.5; font-size: 15px;">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi h·ªá th·ªëng k√≠ch ho·∫°t Locket Gold mi·ªÖn ph√≠ c·ªßa LocketVN !</p>
            
            <div style="background: rgba(255,215,0,0.1); border: 1px solid rgba(255,215,0,0.2); padding: 18px; border-radius: 16px; text-align: left; margin-bottom: 25px; display: flex; gap: 12px; align-items: flex-start;">
                <i class="fa-solid fa-lightbulb" style="color: #FFD700; font-size: 20px; margin-top: 4px; flex-shrink: 0;"></i>
                <div>
                    <strong style="color: #FFD700; font-size: 15px; display: block; margin-bottom: 8px;">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</strong>
                    <ul style="margin: 0; padding-left: 15px; font-size: 13px; color: #ccc; line-height: 1.6;">
                        <li>X√≥a Locket c≈© & h·ªì s∆° c·∫•u h√¨nh c≈© (n·∫øu c√≥).</li>
                        <li>T·∫£i l·∫°i Locket t·ª´ AppStore v√† ƒëƒÉng nh·∫≠p.</li>
                        <li>Nh·∫≠p Username v√†o web ƒë·ªÉ k√≠ch ho·∫°t.</li>
                        <li><b>B·∫Øt bu·ªôc:</b> C√†i ƒë·∫∑t <b>Config iOS</b> (n√∫t b√™n d∆∞·ªõi) ƒë·ªÉ gi·ªØ Gold vƒ©nh vi·ªÖn kh√¥ng b·ªã vƒÉng.</li>
                    </ul>
                </div>
            </div>

            <button class="welcome-btn btn-ok" onclick="closeWelcomeModal()">B·∫Øt ƒë·∫ßu ngay</button>
            <button class="welcome-btn btn-skip" onclick="hideWelcomeModalFor24Hours()">Kh√¥ng hi·ªán l·∫°i (24h)</button>
        </div>
    </div>

    <div class="glow" style="top: -100px; left: -100px;"></div>
    <div class="glow" style="bottom: -100px; right: -100px;"></div>

    <header class="glass">
        <div class="max-w-6xl">
            <a href="/" class="nav-brand">
                <img src="unnamed.jpg" alt="Logo" class="nav-logo">
                <span class="font-bold text-lg gold-text" style="font-weight: 800; font-size: 20px;">LocketVN</span>
            </a>
        </div>
    </header>

    <div class="container">
        <div class="card glass">
            <div class="card-header">
                <h2>Locket Gold</h2>
                <p>K√≠ch Ho·∫°t Locket Gold Vƒ©nh Vi·ªÖn</p>
            </div>

            <div class="form-group">
                <label class="form-label">Username Locket</label>
                <input type="text" id="username" class="form-input" placeholder="V√≠ d·ª•: locket.vn" autocomplete="off">
            </div>

            <button class="submit-btn gold-btn" id="submitBtn" onclick="checkUserInfo()">
                <i class="fa-solid fa-bolt"></i> <span>K√≠ch ho·∫°t Gold</span>
                <i class="fa-solid fa-spinner fa-spin" id="btnLoader" style="display: none;"></i>
            </button>

            <a href="lenhan.mobileconfig" class="config-btn">
                <i class="fa-brands fa-apple" style="font-size: 18px;"></i> T·∫£i Config Ch·ªëng VƒÉng Gold (Only iOS)
            </a>

            <div class="features">
                <p class="features-title">T√≠nh nƒÉng Locket Gold bao g·ªìm:</p>
                <div class="features-grid">
                    <div class="feature-item">
                        <span class="feature-icon-lg">üö´</span>
                        <span>Kh√¥ng c√≥ qu·∫£ng c√°o</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">üé¶</span>
                        <span>Quay Video ng·∫Øn</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">üëÄ</span>
                        <span>Xem ai ƒë√£ truy c·∫≠p</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">üéû</span>
                        <span>T·∫£i ·∫£nh t·ª´ th∆∞ vi·ªán</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">üë®‚Äçüë©‚Äçüëß</span>
                        <span>Th√™m b·∫°n b√®</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">üíõ</span>
                        <span>Thay icon app</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">‚úèÔ∏è</span>
                        <span>Caption d√†i h∆°n</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon-lg">‚ú®</span>
                        <span>Huy hi·ªáu Gold</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        ¬© 2026 LocketVN | Developed by @VNSoftware
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const API_URL = '/api'; 
        // Updated SweetAlert mixin for new button styles
        const swalIOS = Swal.mixin({ 
            customClass: { confirmButton: 'swal-btn-confirm', cancelButton: 'swal-btn-cancel' }, 
            buttonsStyling: false, 
            reverseButtons: true // Important for stacking order
        });

        /* --- LOADING SCREEN LOGIC --- */
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
            }, 800);
            initWelcomeModal();
        });

        /* --- MODAL LOGIC --- */
        function initWelcomeModal() {
            const hiddenUntil = localStorage.getItem('welcomeHiddenUntil');
            if (!hiddenUntil || new Date().getTime() > parseInt(hiddenUntil)) {
                document.getElementById('welcomeModal').classList.add('show');
            }
        }
        function closeWelcomeModal() {
            document.getElementById('welcomeModal').classList.remove('show');
        }
        function hideWelcomeModalFor24Hours() {
            localStorage.setItem('welcomeHiddenUntil', new Date().getTime() + (24*60*60*1000));
            closeWelcomeModal();
        }

        /* --- MAIN UNLOCK LOGIC --- */
        async function checkUserInfo() {
            const username = document.getElementById('username').value.trim();
            if (!username) return swalIOS.fire({ icon: 'warning', title: 'L·ªói', text: 'Vui l√≤ng nh·∫≠p Username!' });

            toggleBtnLoading(true);

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'get-user-info', payload: { username: username } })
                });
                const data = await res.json();

                if (res.ok && data.success) {
                    showConfirm(data.data);
                } else {
                    swalIOS.fire({ icon: 'error', title: 'Th·∫•t b·∫°i', text: 'Kh√¥ng t√¨m th·∫•y user n√†y.' });
                }
            } catch (e) {
                swalIOS.fire({ icon: 'error', title: 'L·ªói Server', text: 'Kh√¥ng th·ªÉ k·∫øt n·ªëi Backend.' });
            } finally {
                toggleBtnLoading(false);
            }
        }

        function showConfirm(user) {
            swalIOS.fire({
                html: `
                    <div>
                        <div class="user-avatar-ring">
                            <img src="${user.profile_picture_url}" class="user-avatar-img" onerror="this.src='https://ui-avatars.com/api/?name=${user.username}'">
                        </div>
                        <h3 class="swal-user-name">${user.first_name} ${user.last_name}</h3>
                        <span class="swal-user-uid">UID: ${user.uid}</span>
                        
                        <div style="margin-top: 10px;">
                            <a href="${user.profile_picture_url}" download="avatar_${user.username}.jpg" target="_blank" class="config-btn" style="width: auto; display: inline-flex; padding: 10px 20px; font-size: 13px;">
                                <i class="fa-solid fa-download"></i> T·∫£i Avatar
                            </a>
                        </div>
                    </div>`,
                title: 'X√°c nh·∫≠n t√†i kho·∫£n',
                showCancelButton: true,
                confirmButtonText: 'Unlock Gold Ngay üöÄ',
                cancelButtonText: 'Kh√¥ng ph·∫£i t√¥i'
            }).then((res) => {
                if (res.isConfirmed) startUnlock(user.username);
            });
        }

        async function startUnlock(username) {
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'restore', payload: { username: username } })
                });
                const data = await res.json();

                if (data.success) {
                    trackQueue(data.client_id, username);
                } else {
                    swalIOS.fire({ icon: 'error', title: 'L·ªói', text: data.msg || 'Kh√¥ng th·ªÉ b·∫Øt ƒë·∫ßu.' });
                }
            } catch (e) {
                swalIOS.fire({ icon: 'error', title: 'L·ªói', text: 'L·ªói k·∫øt n·ªëi khi restore.' });
            }
        }

        function trackQueue(clientId, username) {
            let timer;
            swalIOS.fire({
                title: 'ƒêang x·ª≠ l√Ω...',
                html: `
                    <div class="queue-container">
                        <div style="display:flex; justify-content:space-between; color:#ccc; font-size:13px; font-weight: 600; margin-bottom: 5px;">
                            <span>Ti·∫øn tr√¨nh</span>
                            <span id="q-percent" style="color: #FFD700;">0%</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" id="bar" style="width:0%"></div>
                        </div>
                        <div class="queue-stats">
                            <span id="q-status">ƒêang k·∫øt n·ªëi...</span>
                            <span id="q-pos">V·ªã tr√≠: ...</span>
                        </div>
                    </div>`,
                showConfirmButton: false,
                allowOutsideClick: false
            });

            async function poll() {
                try {
                    const res = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'queue-status', payload: { client_id: clientId } })
                    });
                    const data = await res.json();

                    if (data.status === 'completed') {
                        clearTimeout(timer);
                        swalIOS.fire({
                            icon: 'success',
                            title: 'Th√†nh c√¥ng!',
                            html: '<p style="font-size: 15px; line-height: 1.5;">ƒê√£ k√≠ch ho·∫°t Gold xong.<br>Vui l√≤ng c√†i <b>Config iOS</b> ƒë·ªÉ gi·ªØ Gold vƒ©nh vi·ªÖn.</p>',
                            confirmButtonText: 'Tuy·ªát v·ªùi üòç'
                        });
                    } else if (data.status === 'error') {
                        clearTimeout(timer);
                        swalIOS.fire({ icon: 'error', title: 'L·ªói', text: data.error });
                    } else {
                        updateUI(data);
                        timer = setTimeout(poll, 1500);
                    }
                } catch (e) {
                    timer = setTimeout(poll, 2000);
                }
            }
            poll();
        }

        function updateUI(data) {
            const bar = document.getElementById('bar');
            const percent = document.getElementById('q-percent');
            const status = document.getElementById('q-status');
            const pos = document.getElementById('q-pos');
            
            if(!bar) return;

            if (data.status === 'processing') {
                bar.style.width = '100%';
                status.innerText = 'ƒêang k√≠ch ho·∫°t g√≥i Gold...';
                percent.innerText = '100%';
            } else {
                const p = data.total_queue > 0 ? Math.max(10, (1 - (data.position / (data.total_queue + 1))) * 90) : 15;
                bar.style.width = `${p}%`;
                percent.innerText = `${Math.round(p)}%`;
                status.innerText = 'ƒêang ch·ªù trong h√†ng ƒë·ª£i...';
                pos.innerText = `V·ªã tr√≠: #${data.position}`;
            }
        }

        function toggleBtnLoading(isLoading) {
            const btn = document.getElementById('submitBtn');
            const loader = document.getElementById('btnLoader');
            btn.disabled = isLoading;
            loader.style.display = isLoading ? 'inline-block' : 'none';
        }
    </script>
</body>
</html>
